FROM node:22-alpine

WORKDIR /app

# set mirror for npm
# RUN npm config set registry https://registry.npmmirror.com

COPY ./moon/package*.json ./

RUN npm install

COPY ./moon .

RUN npm run build

COPY ./docker/start_moon.sh /app/start_moon.sh

RUN chmod +x /app/start_moon.sh

EXPOSE 3000

ENTRYPOINT ["/bin/sh", "/app/start_moon.sh"]