From bcb691e423f44aadc34837d514e61bb23f86b32a Mon Sep 17 00:00:00 2001
From: Neon <yyk1249501542@gmail.com>
Date: Tue, 19 Nov 2024 09:36:55 +0800
Subject: [PATCH 20/24] fix crate/collab compile error with mega

---
 Cargo.lock                             | 1 +
 crates/collab/Cargo.toml               | 1 +
 crates/collab/src/tests/test_server.rs | 5 +++++
 3 files changed, 7 insertions(+)

diff --git a/Cargo.lock b/Cargo.lock
index 0483c524c4..a69e9c68c9 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2569,6 +2569,7 @@ dependencies = [
  "live_kit_server",
  "log",
  "lsp",
+ "mega",
  "menu",
  "multi_buffer",
  "nanoid",
diff --git a/crates/collab/Cargo.toml b/crates/collab/Cargo.toml
index ad2c013668..78dcfb30ec 100644
--- a/crates/collab/Cargo.toml
+++ b/crates/collab/Cargo.toml
@@ -101,6 +101,7 @@ language = { workspace = true, features = ["test-support"] }
 language_model = { workspace = true, features = ["test-support"] }
 live_kit_client = { workspace = true, features = ["test-support"] }
 lsp = { workspace = true, features = ["test-support"] }
+mega.workspace = true
 menu.workspace = true
 multi_buffer = { workspace = true, features = ["test-support"] }
 node_runtime.workspace = true
diff --git a/crates/collab/src/tests/test_server.rs b/crates/collab/src/tests/test_server.rs
index 210a049e0b..bb9fb96f70 100644
--- a/crates/collab/src/tests/test_server.rs
+++ b/crates/collab/src/tests/test_server.rs
@@ -44,6 +44,7 @@ use std::{
         Arc,
     },
 };
+use mega::Mega;
 use workspace::{Workspace, WorkspaceStore};
 
 pub struct TestServer {
@@ -271,6 +272,7 @@ impl TestServer {
         let workspace_store = cx.new_model(|cx| WorkspaceStore::new(client.clone(), cx));
         let language_registry = Arc::new(LanguageRegistry::test(cx.executor()));
         let session = cx.new_model(|cx| AppSession::new(Session::test(), cx));
+        let mega = cx.new_model(|cx| Mega::new(cx));
         let app_state = Arc::new(workspace::AppState {
             client: client.clone(),
             user_store: user_store.clone(),
@@ -280,6 +282,7 @@ impl TestServer {
             build_window_options: |_, _| Default::default(),
             node_runtime: NodeRuntime::unavailable(),
             session,
+            mega,
         });
 
         let os_keymap = "keymaps/default-macos.json";
@@ -401,6 +404,7 @@ impl TestServer {
         let workspace_store = cx.new_model(|cx| WorkspaceStore::new(client.clone(), cx));
         let language_registry = Arc::new(LanguageRegistry::test(cx.executor()));
         let session = cx.new_model(|cx| AppSession::new(Session::test(), cx));
+        let mega = cx.new_model(|cx| Mega::new(cx));
         let app_state = Arc::new(workspace::AppState {
             client: client.clone(),
             user_store: user_store.clone(),
@@ -410,6 +414,7 @@ impl TestServer {
             build_window_options: |_, _| Default::default(),
             node_runtime: NodeRuntime::unavailable(),
             session,
+            mega,
         });
 
         cx.update(|cx| {
-- 
2.43.0

